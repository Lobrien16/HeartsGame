<html>
<head>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="styles/main.css" />
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="scripts/3rdparty/gif.js/dist/gif.js"></script>
    <script src="scripts/lib/ebtext.js"></script>
    <script>
        $(document).ready(function() {
            var saveData = (function () {
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                return function (blob, fileName) {
                    var url = window.URL.createObjectURL(blob);
                    a.href = url;
                    a.download = fileName;
                    a.click();
                    window.URL.revokeObjectURL(url);
                };
            }());
            EarthboundText.preload_assets();
            var generated = false;
            currentBlob = null;
            $('#tabs a').click(function (e) {
                e.preventDefault()
                $(this).tab('show')
            })
            $('#generate').click(function (e) {
                e.preventDefault();
                $('.loader').addClass('loading');
                document.getElementById('image').src = '';
                EarthboundText.render({
                    canvas: document.getElementById('bitmap'),
                    flavor: $('input:radio[name=flavor]:checked').val(),
                    speed: $('input:radio[name=speed]:checked').val(),
                    text: $('#text').val(),
                    on_render: function(blob) {
                        currentBlob = blob
                        $('#image').attr('src', URL.createObjectURL(blob));
                        $('.loader').removeClass('loading');
                        generated = true;
                        $('.actions').removeClass('hidden');
                    }
                });
            });
            $('#save_image').click(function() {
                var fileName = $('#text').val().substring(0, 32).toLowerCase().replace(/[\W]+/gi, '-') + '.gif';;
                saveData(currentBlob, fileName);
            });
            $('#upload_imgur').click(function(e) {
                e.preventDefault();
                var w = window.open();
                var reader = new FileReader();
                reader.readAsDataURL(currentBlob); 
                reader.onloadend = function() {
                    $.ajax({
                        url: 'https://api.imgur.com/3/image',
                        type: 'POST',
                        headers: {
                            Authorization: 'Client-ID 335c77caef813da'
                        },
                        data: {
                            type: 'base64',
                            name: 'ebtext.gif',
                            description: 'Made with EarthBound Text Labs (http://billeager.com/ebtext)\n\n#earthbound #text #gif #ebtextlabs',
                            image: reader.result.split(',')[1]
                        },
                        dataType: 'json'
                    }).success(function(data) {
                        var url = 'http://imgur.com/' + data.data.id + '?tags';
                        w.location.href = url;
                    }).error(function() {
                        alert('Could not reach api.imgur.com. Sorry :(');
                        w.close();
                    });
                }
            });
        });
    </script>
    <title>EarthBound Text Labs</title>
</head>
<body>
    <div class="contain">
        <div class="main">
            <div class="stage">
                <div class="loader">
                </div>
                <canvas id="bitmap"></canvas>
                <img id="image" src="images/splash.gif" />
                <div class="actions hidden">
                    <button id="save_image" class="btn btn-default">Save <i class="fa fa-floppy-o"></i></button>
                    <button id="upload_imgur" class="btn btn-default">Upload to Imgur <i class="fa fa-cloud-upload"></i></button>
                </div>
            </div>

            <div class="container solid">
                <ul id="tabs" class="nav nav-tabs">
                    <li class="active"><a href="#home" data-toggle="tab">Make text</a></li>
                   
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="home">
                        <form>
                            <fieldset>
                                <label for="text">Input Text</label>
                                <textarea id="text" name="text" class="form-control" rows="3" placeholder="Enter your text here.
Backslashes will add\ pauses\\ to\\\ your text.
See the Help tab for more!"></textarea><br />
                                <label for="speed">Text Speed</label>
                                <div class="btn-group" data-toggle="buttons">
                                    <label class="btn btn-primary active">
                                        <input type="radio" name="speed" checked="checked" value="15" />Fast
                                    </label>
                                    <label class="btn btn-primary">
                                        <input type="radio" name="speed" value="33" />Medium
                                    </label>
                                    <label class="btn btn-primary">
                                        <input type="radio" name="speed" value="50" />Slow
                                    </label>
                                </div><br /><br />
                                <label for="speed">Flavor</label>
                                <div class="btn-group" data-toggle="buttons">
                                    <label class="btn btn-primary active">
                                        <input type="radio" name="flavor" checked="checked" value="plain" />Plain
                                    </label>
                                    <label class="btn btn-primary">
                                        <input type="radio" name="flavor" value="mint" />Mint
                                    </label>
                                    <label class="btn btn-primary">
                                        <input type="radio" name="flavor" value="strawberry" />Strawberry
                                    </label>
                                    <label class="btn btn-primary">
                                        <input type="radio" name="flavor" value="banana" />Banana
                                    </label>
                                    <label class="btn btn-primary">
                                        <input type="radio" name="flavor" value="peanut" />Peanut
                                    </label>
                                </div><br /><br />
                                    <button id="generate" class="btn btn-primary btn-lg">Generate</button>
                            </fieldset>
                        </form>
                    </div>
                
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    </body>
</html>